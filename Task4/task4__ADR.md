### <a name="_b7urdng99y53"></a>**Название задачи: Балансировка нагрузки на call-центр** 
### <a name="_hjk0fkfyohdk"></a>**Автор: Григорьев А.Ю.**
### <a name="_uanumrh8zrui"></a>**Дата: 19.07.2025**
### <a name="_3bfxc9a45514"></a>**Функциональные требования**
Опишите здесь верхнеуровневые Use Cases. Их нужно оформить в виде таблицы с пошаговым описанием:

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
|UC4| Клиент | Консультация клиента по ставкам в кол-центре банка |1. Клиент звонит в кол-центр банка, чтобы уточнить текущие ставки по депозитам.<br>2. Оператор кол-центра открывает внутренний web-интерфейс Call-центра.<br>3. Система отображает актуальные ставки, предварительно подгруженные из Kafka (deposit-request).<br>4. Оператор видит список депозитов с условиями и может ответить на вопросы клиента.|
|UC5|Партнерский call-центр|Передача актуальных ставок партнерскому кол-центру|1. Банк обновляет ставки в своей системе (АБС, размещает в kafka).<br>2. Автоматически формируется файл (rates_YYYYMMDD.csv) с актуальными ставками.<br>3. Файл передается через SFTP на сервер партнерского кол-центра (при изменении ставок, либо по retry)<br>4. Система партнера загружает файл и обновляет локальную базу данных.<br>5. Операторы партнерского кол-центра видят актуальные ставки в своем интерфейсе.|
|UC6|Call-центр|Обработка повышенной нагрузки в кол-центре|1. При росте звонков система мониторинга банка фиксирует нагрузку. <br>2.Автоматически часть звонков (не VIP) перенаправляется на партнерский кол-центр.<br>3. Операторы партнера консультируют клиентов на основе актуальных ставок из полученного файла.<br>4. Если клиент хочет открыть депозит, оператор партнера направляет его на сайт банка или в отделение.|

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
Опишите здесь нефункциональные требования и архитектурно значимые требования.

|**№**|**Требование**|
| :-: | :- |
| F1 | Система должна автоматически распределять входящие звонки между основным и партнерским call-центром при превышении порога нагрузки |
| F2 | Операторы партнерского call-центра должны иметь доступ к актуальным депозитным ставкам в своем интерфейсе |
| F3 | Система должна формировать и передавать файл с актуальными ставками на сервер партнера по факту обновления с задержкой не более 1 минуты |
| F4 | В интерфейсе оператора партнерского call-центра должна отображаться дата последнего обновления ставок |
| F5 | Система должна вести журнал передачи файлов со ставками партнеру с фиксацией времени и статуса передачи |
| F6 | При перенаправлении звонка в партнерский call-центр система должна передавать минимальный набор данных о клиенте (номер телефона, тип запроса) |
| F7 | Система должна предоставлять отчеты о количестве звонков, обработанных партнерским call-центром |
| F8 | Операторы партнерского call-центра должны иметь возможность переводить звонок обратно в основной call-центр |
| +R1 | Передача данных в партнерский call-центр должна осуществляться только через SFTP-протокол |
| +R2 | Партнерский call-центр не имеет прямого доступа к внутренним системам банка |
| +R3 | Файлы со ставками должны передаваться в зашифрованном виде |
| +R4 | Максимальный размер файла со ставками не должен превышать 1 МБ |
| +R5 | Задержка между изменением ставок в банковской системе и их обновлением в партнерском call-центре не должна превышать 1 минуты |
| +R6 | Система должна сохранять историю передаваемых файлов со ставками минимум 30 дней |
| +R7 | При перенаправлении звонка запрещена передача персональных данных клиента (кроме номера телефона) |
| +R8 | Партнерский call-центр не имеет права самостоятельно изменять ставки в полученных файлах |

### <a name="_qmphm5d6rvi3"></a>**Решение**

Добавляем следующие модули:
<br>1. Микросервис Шлюз для выгрузки ставок. Горизонтально масштабируемый микросервис
  <br>Вводим микросервис для того, чтобы в партнерский сервис передать ставки контроллируемо из внутренней кафки. Микросервис бэковый, подписан на топик с обновлением ставок из АБС. 
    <br>Микросервис написан на .NET Framework 4.5 (например, на C#) - как и все новые бэковые модули ниже.
    <br>БД отсутствует. При необходимости выполнить retry отложенно использует отдельный топик кафка (паттерн dead-queue).
   <br>Микросервис шифрует и подписывает файлы и передает партнеру

 2. Кафка deposit-request.
  Появляется еще 2 подписчика на инфу о ставках:
  <br>2.1. Call-center внутренний
  <br>2.2. Шлюз выгрузки ставок (для партнерского call-центра)

  3. Call-balancer.
  Балансировщик трафика звонков на
  <br>2.1. Call-center внутренний
  <br>2.1. Call-center подрядчика (не VIP, при перегрузках внутреннего)
 
### <a name="_bjrr7veeh80c"></a>**Альтернативы**

Альтернативные решения не рассматривались.

**Недостатки, ограничения, риски**

1. Риск того, что VIP клиент не дозвонится. Для него желательно предусмотреть выделенную линию. И отдельный процесс по индивидуальным ставкам
2. В рамках проекта не рассмотрен вопрос передачи ключей шифрования от банка подрядчику и процесс их замены
3. В рамках проекта не рассмотрены Мониторинг, трейсинг, логирование, но должны присутствовать в контуре банка.


