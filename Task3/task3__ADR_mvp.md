### <a name="_b7urdng99y53"></a>**Название задачи: Открытие депозитов онлайн** 
### <a name="_hjk0fkfyohdk"></a>**Автор: Григорьев А.Ю.**
### <a name="_uanumrh8zrui"></a>**Дата: 19.07.2025**
### <a name="_3bfxc9a45514"></a>**Функциональные требования**
Опишите здесь верхнеуровневые Use Cases. Их нужно оформить в виде таблицы с пошаговым описанием:

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
|UC1| Новый клиент| Открытие депозита через сайт |1. Клиент заходит на сайт банка.<br>2. Видит список доступных депозитов с актуальными ставками.<br>3. Выбирает подходящий депозит.<br>4. Заполняет форму заявки (ФИО, номер телефона).<br>5. Подтверждает отправку заявки.<br>6. Получает уведомление об успешной подаче заявки.<br>7. Менеджер кол-центра получает заявку, звонит клиенту для уточнения деталей.<br>8. Клиент приходит в отделение для идентификации и подписания документов.<br>9. Менеджер бэк-офиса подтверждает заявку в АБС.<br>10. Клиент получает SMS-уведомление об открытии депозита.|
|UC2|Существующий клиент|Открытие депозита через интернет-банк|1. Клиент авторизуется в интернет-банке.<br>2. Видит список депозитов с общими и персонализированными ставками.<br>3. Выбирает депозит, указывает сумму и счет для списания.<br>4. Подтверждает операцию SMS-кодом.<br>5. Заявка поступает в бэк-офис.<br>6. Менеджер проверяет и подтверждает заявку в АБС.<br>7. Клиент получает SMS-уведомление об открытии депозита.<br>8. Подписанные документы автоматически загружаются в АБС.|
|UC3|Менелжер бэк-офиса|Обновление ставок|1. Бэк-офис вносит изменения в систему<br>2. Ставки обновляются на сайте и в интернет-банке|

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
Опишите здесь нефункциональные требования и архитектурно значимые требования.

|**№**|**Требование**|
| :-: | :- |
| F   | Функциональные (Functionality)     |              |
| F1  | Клиент может подать заявку на депозит через сайт (ФИО + телефон) | Только для новых клиентов |
| F2  | Клиент может подать заявку через интернет-банк (счёт + сумма + SMS-подтверждение) | Для существующих клиентов |
| F3  | Сайт и интернет-банк позволяют отображать общий список депозитов с актуальными ставками |  |
| F4  | Интернет-банк позволяют отображать персонализированные ставки | Индивидуальные условия |
| F5  | Менеджер call-центра должен иметь возможность для обработки заявок с сайта, в том числе предложить особые условия |  |
| F6  | Менеджер back-оффиса подтверждает заявку на депозит в АБС | На этапе MVP |
| F7  | Интернет-банк и АБС должны поддержать отправку SMS-уведомлений клиенту (подтверждение ставки/открытие депозита) | Лучше реализовать силами команды разработки банка |
| F8  | Централизованное хранение ставок в системе. | Доступ для бэк-офисов и прочих систем. Возможно в АБС. |
| F9  | По результатм оформления депозита документы, подписанные Клиентом, должны загружаться в АБС |  |
| +R  | + Ограничения (Restrictions)       |              |
| +R1 | Необходимо минимизировать доработки, выполняемые силами подрядчика | Например, реализовать функциональность СМС-модуля силами команды Банка |
| +R1 | Желательно использовать существующие технологии (например, БД MS SQL/Oracle) | Необходимо экспертиза среди существующих сотрудников |
| +R2 | Если нужны очереди сообщений, то лучше использовать Kafka |  |
| +R3 | Нужно перевести интернет-банк на микросервисную архитектуру, только в рамках задачи открытия депозитов. |  |
| +R4 | Интеграция Интернет-банка и АБС должна осуществляться через брокер сообщений | Асинхронная интеграция |
| +R5 | АБС может масштабироваться только вертикально из-за БД| |
| +R6 | Интеграция Сайта и Интернет-Банка должна быть защищена стредствами шифрования траффика  |  |
| +R7  | Для интернет-банка необходимо предусмотреть равномерное горизонтальное масштабирование и распределение запросов между серверами, приложениями и ЦОД.  | Поддержать переключение  на резервный ЦОД |

### <a name="_qmphm5d6rvi3"></a>**Решение**

Добавляем следующие модули:
<br>1. Микросервис Депозиты, со своей БД. Горизонтально масштабируемый микросервис
  <br>Вводим микросервис для того, чтобы в АБС передавать нагрузку асинхронно, контроллируемо. Микросервис бэковый, получает заявку от Интернет-банка. 
    <br>Микросервис написан на .NET Framework 4.5 (например, на C#) - как и все новые бэковые модули ниже.
    <br>БД выбрана MS SQL как БД Интернет-Банка. Поскольку скорее всего и сопровождать будут сотрудники, работающие над интернет-банком.
   <br>Микросервис Депозиты отсылает СМС клиенту и временно записывает в свою БД состояние депозита. При получении подтверждения из интернет-банка, заявка проталкивается дальше - в Кафку, с которой уже работает АБС.

 2. Кафка deposit-request.
  Используется в трех режимах:
  <br>2.1. Топик для открытия депозита через интернет-банк (нужен для снижения нагрузки на АБС)
  <br>2.2. Топик для заявки на депозит через web-сайт (нужен для того, чтобы не потерять заявку по пути от web-сайт к колл-центру, иначе нужно повышать уровень доступности сервисов)
  <br>2.3. Распростанить информацию о новых ставках по системе, из ЕБС. В топик размещает информацию АБС Контроллер.
 
 3. АБС Контроллер. Горизонтально масштабируемый микросервис, оборачивающий вызовы логики АБС на уровне БД (PL/SQL). Также восполняет технологический пробел (Delfi и Oracle не работают с Kafka) при исходящем информировании об изменнных ставках. 
 <br> Умеет контроллировать нагрузку за счет исходящего рейт-лимитера и равномерно вычитывающий заявки их kafka.

### <a name="_bjrr7veeh80c"></a>**Альтернативы**

Альтернативы: 
1. В новых сервисах использовать PostgreSQL, но на текущий момент нет компетенций.
2. Сделать мониторинг решения и аналитику, но нет компетенций.

**Недостатки, ограничения, риски**

1. Страновые риски. Надо отказываться от Oracle и MS SQL
2. Дорогое сопровождение (Oracle и MS SQL)
3. Сотрудник бэк-офиса находится посередине автоматизированного процесса. Желательно его заменить для 99%  процентов открытий депозитов (стандартные ставки, суммы до 1,4 млн, старый клиент)
4. Отсутствует мониторинг, трейсинг, единое логирование.
5. Отстствует аналитическая платформа


